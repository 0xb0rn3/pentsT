#!/usr/bin/env bash

# Color definitions 
DIM='\033[2m'
ITALIC='\033[3m'
UNDERLINE='\033[4m'
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
PURPLE='\033[1;35m'
CYAN='\033[1;36m'
WHITE='\033[1;37m'
GRAY='\033[0;90m'
NC='\033[0m'

# Verify root privileges
if [ "$EUID" -ne 0 ]; then
    print_status "Root Privileges" "FAIL"
    echo -e "${RED}I REFUSE TO RUN WITHOUT SUDO!${NC}"
    exit 1
fi
if [ -z "$SUDO_USER" ]; then
    print_status "User Detection" "FAIL"
    echo -e "${RED}Please run with sudo, not as root${NC}"
    exit 1
fi
print_status "Privilege Check" "OK"
}

# Define the path to the PentsT root directory
PENTST_DIR="/home/oxborn3/pentsT"

# Change to the PentsT root directory
cd "$PENTST_DIR" || { echo "Failed to change directory to $PENTST_DIR"; exit 1; }

# Display the banner with original visuals
echo -e "\e[34m██████╗ ███████╗███╗   ██╗████████╗███████╗████████╗\e[0m"
echo -e "\e[34m██╔══██╗██╔════╝████╗  ██║╚══██╔══╝██╔════╝╚══██╔══╝\e[0m"
echo -e "\e[34m██████╔╝█████╗  ██╔██╗ ██║   ██║   ███████╗   ██║   \e[0m"
echo -e "\e[34m██╔═══╝ ██╔══╝  ██║╚██╗██║   ██║   ╚════██║   ██║   \e[0m"
echo -e "\e[34m██║     ███████╗██║ ╚████║   ██║   ███████║   ██║   \e[0m"
echo -e "\e[34m╚═╝     ╚══════╝╚═╝  ╚═══╝   ╚═╝   ╚══════╝   ╚═╝   \e[0m"
echo -e "\e[34m====================================================\e[0m"
echo -e "\e[34m        PENTST INSTALLATION SCRIPT v0.1 ALFA    \e[0m"
echo -e "\e[34m        Reengineered and Maintained by 0xb0rn3    \e[0m"
echo -e "\e[34m====================================================\e[0m"
echo ""

# Ensure the utils directory contains __init__.py to make it a package
if [ ! -f "utils/__init__.py" ]; then
    echo "Creating __init__.py in utils/"
    touch utils/__init__.py
fi

# Install any required Python dependencies system-wide (if requirements.txt exists)
if [ -f "requirements.txt" ]; then
    echo "Installing Python dependencies..."
    sudo pip3 install -r requirements.txt
fi

# Loop over all .ini files in the configs/ directory
for config in configs/*.ini; do
    # Check if the config file exists (in case there are no .ini files)
    if [ -f "$config" ]; then
        echo "Processing configuration: $config"
        # Run tooltime.py as a module with sudo
        sudo python3 -m utils.tooltime "$config"
    else
        echo "No configuration files found in configs/"
        break
    fi
done

echo "Installation completed."
